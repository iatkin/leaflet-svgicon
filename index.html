<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
        <script src="svg-icon.js"></script>
        <script src="subclass-examples.js"></script>
        <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
        <style>
            body {
                font-family: -apple-system, sans-serif;
            }
            .disabled {
                color: grey;
            }
            #example-map {
                position: absolute;
                left: 420px;
                top: 10px;
                height: 400px;
                width: 400px;
            }
            #iconOptions {
                position: absolute;
                top: 10px;
                left: 10px;
                width: 400px;
                height: 100%;
            }
            #iconOptions label {
                display: block;
                margin-bottom: 5px;
            }
            label {
                width: 400px;
            }
            label input, label select {
                width: 200px;
                position: absolute;
                left: 185px;
                margin: 0px;
                display: inline-block;
            }
            label span {
                display: inline-block;
                width: 180px;
                text-align: right;
            }
            #modify-button {
                position: absolute;
                left: 185px;
            }
        </style>
        <script>
            var testMarker = null
            var map = null
            var latlng = L.latLng(38.88948, -77.03526)
            $(document).ready(function() {
                map = L.map("example-map", {
                    "center": latlng,
                    "zoom": 16,
                    "zoomControl": false
                })
                var baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                });
                map.addLayer(baseLayer)
                testMarker = L.marker.svgMarker(latlng)
                map.addLayer(testMarker)
  
                var changeIcon = function() {
                    var iconOptions = {}

                    $("#iconOptions > label").each(function() {
                        var key = $(this).attr("id")
                        var value = $(this).children("input").val()

                        if (value[0] == "[") {
                            value = JSON.parse(value)
                            value = L.point(value[0], value[1])
                        }
                        if (value) {
                            iconOptions[key] = value
                        }
                    })

                    iconOptions["shadowEnable"] = $("#shadowEnable input")[0].checked

                    testMarker.setIcon(testMarker.options.iconFactory(iconOptions))
                }

                $("#modify-button").on("click", changeIcon)

                $("input").keypress(function(e) {
                    if (e.which == 13) { //13 is the key code for enter
                        changeIcon()
                    }
                })

                var resetInputs = function() {
                    $("label[id^=\"circle\"]").css("display", "block")
                    $("label[id^=\"font\"]").css("display", "block")
                    $("#circleAnchor input").attr("placeholder", "[iconSize.x/2, iconSize.x/2]")
                    $("#color input").attr("placeholder", "rgb(100,102,255)")
                    $("#iconSize input").attr("placeholder", "[36,48]")
                    $("#weight input").attr("placeholder", "2")
                }

                $("select").bind("change", function() {
                    var iconType = $(this).val()

                    if (iconType == "default") {
                        testMarker.options.iconFactory = L.divIcon.svgIcon
                        resetInputs()
                    }
                    else if (iconType == "rhombus") {
                        testMarker.options.iconFactory = L.divIcon.svgIcon.rhombusIcon
                        resetInputs()
                        $("#circleAnchor input").attr("placeholder", "[iconSize.x/2, iconSize.y/2]")
                    }
                    else if (iconType == "monument") {
                        testMarker.options.iconFactory = L.divIcon.svgIcon.washingtonMonumentIcon
                        resetInputs()
                        $("label[id^=\"circle\"]").css("display", "none")
                        $("label[id^=\"font\"]").css("display", "none")
                        $("#color input").attr("placeholder", "rgb(100,100,100)")
                        $("#iconSize input").attr("placeholder", "[10,112]")
                        $("#weight input").attr("placeholder", "1")
                    }
                    changeIcon()
                })

                $("#shadowEnable input").change(function() {
                    if (this.checked == true) {
                        $("label[id^=\"shadow\"]").removeClass("disabled")
                    }
                    else {
                        $("label[id^=\"shadow\"]").addClass("disabled")
                    }
                    $("label[id^=\"shadow\"] input").attr("disabled", !this.checked)
                    $("#shadowEnable").removeClass("disabled")
                    $("#shadowEnable input").attr("disabled", false)
                })
            })
        </script>
    </head>
    <div id="iconOptions">
        <div>Specify points in the format [x,y]</div>
        <div><label id="iconType"><span>Icon Type</span> <select>
            <option value="default">Default</option>
            <option value="rhombus">Rhombus Example</option>
            <option value="monument">Washington Monument Example</option>
        </select></label></div>
        <label id="circleAnchor"><span>Circle Anchor</span> <input type=text placeholder="[iconSize.x/2, iconSize.x/2]"></label>
        <label id="circleColor"><span>Circle Border Color</span> <input type=text placeholder="same as bordercolor"></label>
        <label id="circleOpacity"><span>Circle Border Opacity</span> <input type=text placeholder="same as border opacity"></label>
        <label id="circleFillColor"><span>Circle Fill Color</span> <input type=text placeholder="rgb(255,255,255)"></label>
        <label id="circleFillOpacity"><span>Circle Fill Opacity</span> <input type=text placeholder="same as border opacity"></label>
        <label id="circleImagePath"><span>Circle Image Path</span> <input type="text" placeholder='""'></label>
        <label id="circleImageSize"><span>Circle Image Size</span> <input type="text" placeholder="[iconSize.x/4, iconSize.x/4]"></label>
        <label id="circleImageAnchor"><span>Circle Image Anchor</span> <input type="text" placeholder="[(iconSize.x - circleImageSize.x / 2, [(iconSize.x - circleImageSize.y / 2)]"></label>
        <label id="circleRatio"><span>Circle Ratio</span> <input type=text placeholder="0.5"></label>
        <label id="circleText"><span>Circle Text</span> <input type=text placeholder='""'></label>
        <label id="circleWeight"><span>Circle Border Weight</span> <input type=text placeholder="2"></label>
        <label id="color"><span>Border Color</span> <input type=text placeholder="rgb(0,102,255)"></label>
        <label id="fillColor"><span>Fill Color</span> <input type=text placeholder="same as border color"></label>
        <label id="fillOpacity"><span>Fill Opacity</span> <input type=text placeholder="0.4"></label>
        <label id="fontColor"><span>Font Color</span> <input type=text placeholder="rgb(0,0,0)"></label>
        <label id="fontOpacity"><span>Font Opacity</span> <input type=text placeholder="1"></label>
        <label id="fontSize"><span>Font Size</span> <input type=text placeholder="iconSize.x/4"></label>
        <label id="fontWeight"><span>Font Weight</span> <input type=text placeholder="normal"></label>
        <label id="iconAnchor"><span>Icon Anchor</span> <input type=text placeholder="[iconSize.x/2, iconSize.y]"></label>
        <label id="iconSize"><span>Icon Size</span> <input type=text placeholder="[32,48]"></label>
        <label id="opacity"><span>Border Opacity</span> <input type=text placeholder="1"></label>
        <label id="weight"><span>Border Weight</span> <input type=text placeholder="2"></label>
        <br>
        <label id="shadowEnable"><span>Enable Shadow</span> <input style='width: 20px' type=checkbox></label>
        <label id="shadowAngle" class='disabled'><span>Shadow Angle</span> <input type=text placeholder="45" disabled></label>
        <label id="shadowBlur" class='disabled'><span>Shadow Blur</span> <input type=text placeholder="1" disabled></label>
        <label id="shadowColor" class='disabled'><span>Shadow Color</span> <input type=text placeholder="rgb(0,0,10)" disabled></label>
        <label id="shadowLength" class='disabled'><span>Shadow Length</span> <input type=text placeholder="0.75" disabled></label>
        <label id="shadowOpacity" class='disabled'><span>Shadow Opacity</span> <input type=text placeholder="0.5" disabled></label>
        <label id="shadowTranslate" class='disabled'><span>Shadow Translate</span> <input type=text placeholder="[0,0]" disabled></label>
        <div><input type="button" value="Modify Marker Icon" id="modify-button"><div>
    </div>
    <div id="example-map"></div>
</html>
